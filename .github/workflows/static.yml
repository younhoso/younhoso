name: TypeScript Vite Project

on:
  push:
    paths:
      - "project_mini/motion-min-project/**"
    branches:
      - main
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    defaults:
      run:
        working-directory: project_mini/motion-min-project

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "18"
          cache: "npm"
          cache-dependency-path: project_mini/motion-min-project/package-lock.json

      # ⚠️ Vite base는 가능하면 sed로 파일 수정하지 말고 env로 주는 게 안정적
      # (아래처럼 VITE_BASE를 build 때 넘겨서 config에서 읽는 방식 권장)
      - name: Install dependencies (fast, reproducible)
        run: npm ci

      - name: Build project
        env:
          # 레포가 younhoso/motion-min-project 같은 형태면 보통 "/<repo>/"가 맞습니다.
          # monorepo 하위 폴더를 pages로 올리는 경우에도 최종 URL은 repo 기준이므로 우선 "/<repo>/" 추천
          VITE_BASE: "/younhoso/"
        run: npm run build

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: project_mini/motion-min-project/dist
          # force_orphan은 느려질 수 있어 기본은 끄는 걸 추천
          # 필요할 때만 true로
          force_orphan: false
